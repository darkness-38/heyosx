import { Button, VerticalBox, HorizontalBox, LineEdit, ComboBox } from "std-widgets.slint";

export component AppWindow inherits Window {
    title: "heyOS Greeter";
    no-frame: true;
    background: #111; // Opaque background instead of transparent
    default-font-family: "Segoe UI, Tahoma, sans-serif";

    callback login(string, string, string);

    in property <[string]> users: ["marvin", "hey"];
    in property <[string]> sessions: ["heydm", "sway"];
    in property <string> error-message: "";
    
    // Properties for clock
    in property <string> current-time: "12:20 AM";
    in property <string> current-date: "Saturday, May 2, 2020";

    out property <string> selected-user: users[user-index];
    out property <string> selected-session: sessions[0];
    
    property <int> user-index: 0;
    property <bool> show-user-list: false;

    // Background gradient matching greeter.png
    Rectangle {
        width: 100%;
        height: 100%;
        background: @linear-gradient(135deg, #a67c52 0%, #4a8c9c 60%, #1e4552 100%);
    }

    // Main Centered Layout
    VerticalBox {
        alignment: center;
        spacing: 60px;

        // Top Clock Section
        VerticalBox {
            spacing: 0px;
            Text {
                text: root.current-time;
                font-size: 100px;
                font-weight: 300;
                color: white;
                horizontal-alignment: center;
            }
            Text {
                text: root.current-date;
                font-size: 28px;
                font-weight: 400;
                color: white;
                horizontal-alignment: center;
            }
        }

        // Main Login Area
        VerticalBox {
            spacing: 25px;
            alignment: center;

            // User Avatar
            Rectangle {
                width: 140px;
                height: 140px;
                border-radius: 70px;
                border-width: 2px;
                border-color: white;
                background: transparent;
                clip: true;

                Rectangle {
                    width: 48px;
                    height: 48px;
                    border-radius: 24px;
                    border-width: 2px;
                    border-color: white;
                    x: 46px;
                    y: 28px;
                }
                Rectangle {
                    width: 96px;
                    height: 50px;
                    border-radius: 48px;
                    border-width: 2px;
                    border-color: white;
                    x: 22px;
                    y: 90px;
                }
            }

            // Username with Mini Arrow
            HorizontalBox {
                alignment: center;
                spacing: 10px;
                Text {
                    text: root.selected-user;
                    font-size: 36px;
                    font-weight: 400;
                    color: white;
                }
                
                // Mini Arrow / User Changer Trigger
                Rectangle {
                    width: 24px;
                    height: 24px;
                    Text {
                        text: "⌄";
                        font-size: 24px;
                        color: white;
                        vertical-alignment: center;
                    }
                    TouchArea {
                        clicked => { root.show-user-list = !root.show-user-list; }
                    }
                }
            }

            // User Dropdown List (Simulated)
            if (root.show-user-list) : Rectangle {
                width: 200px;
                height: 80px;
                background: #ffffffdd;
                border-radius: 4px;
                VerticalBox {
                    padding: 5px;
                    for user[i] in root.users : Rectangle {
                        height: 30px;
                        background: user-touch.has-hover ? #0078d7 : transparent;
                        HorizontalBox {
                            padding-left: 10px;
                            alignment: start;
                            Text {
                                text: user;
                                color: user-touch.has-hover ? white : black;
                                vertical-alignment: center;
                            }
                        }
                        user-touch := TouchArea {
                            clicked => { 
                                root.user-index = i;
                                root.show-user-list = false;
                            }
                        }
                    }
                }
            }

            // Password Input
            HorizontalBox {
                alignment: center;
                spacing: 0px;
                
                Rectangle {
                    width: 280px;
                    height: 38px;
                    background: white;
                    border-width: 1px;
                    border-color: #999999;
                    
                    pwd := LineEdit {
                        width: 100%;
                        height: 100%;
                        placeholder-text: "Password";
                        input-type: password;
                        font-size: 16px;
                        accepted => { root.login(root.selected-user, self.text, root.selected-session); }
                    }
                }
                
                Rectangle {
                    width: 38px;
                    height: 38px;
                    background: touch.pressed ? #bbbbbb : (touch.has-hover ? #dddddd : #eeeeee);
                    border-color: #999999;
                    border-width: 1px;
                    
                    Text {
                        text: "➔";
                        font-size: 20px;
                        color: #444444;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }

                    touch := TouchArea {
                        clicked => { root.login(root.selected-user, pwd.text, root.selected-session); }
                    }
                }
            }

            if (root.error-message != "") : Text {
                text: root.error-message;
                color: #ff4d4d;
                font-size: 14px;
                horizontal-alignment: center;
            }
        }
    }

    // Bottom System Controls
    HorizontalBox {
        y: parent.height - 120px;
        width: 100%;
        alignment: center;
        spacing: 50px;

        VerticalBox {
            spacing: 8px; alignment: center;
            Text { text: "☾"; color: white; font-size: 28px; horizontal-alignment: center; }
            Text { text: "Sleep"; color: white; font-size: 14px; horizontal-alignment: center; }
        }
        VerticalBox {
            spacing: 8px; alignment: center;
            Text { text: "↻"; color: white; font-size: 28px; horizontal-alignment: center; }
            Text { text: "Restart"; color: white; font-size: 14px; horizontal-alignment: center; }
        }
        VerticalBox {
            spacing: 8px; alignment: center;
            Text { text: "⏻"; color: white; font-size: 28px; horizontal-alignment: center; }
            Text { text: "Shut Down"; color: white; font-size: 14px; horizontal-alignment: center; }
        }
        VerticalBox {
            spacing: 8px; alignment: center;
            Text { text: "⌨"; color: white; font-size: 28px; horizontal-alignment: center; }
            Text { text: "Other..."; color: white; font-size: 14px; horizontal-alignment: center; }
        }
    }

    // Bottom Right: Session Changer (Fixed Height)
    Rectangle {
        x: parent.width - self.width - 40px;
        y: parent.height - self.height - 40px;
        width: 180px;
        height: 60px; // Explicitly constrained height

        VerticalBox {
            spacing: 4px;
            Text { text: "Session"; color: white; font-size: 14px; }
            ComboBox {
                height: 32px; // Explicit height for ComboBox
                model: root.sessions;
                current-value: root.selected-session;
                selected(val) => { root.selected-session = val; }
            }
        }
    }
}